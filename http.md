# url 输入后

1. 浏览器会先拆分网址：http 协议，域名，可能还有路径及参数
   然后浏览器解析查询浏览器缓存，系统缓存，本地域名服务器直到找到此域名的 ip 地址

2. 接下来是浏览器对此服务器进行 TCP 连接，首先进行三次握手
   先由客户端发送 syn 给浏览器告知浏览器希望与服务器联系，服务器收到后回复 ack，之后客户端再发送了 ack 便开始通信了，双方传递数据。
   (浏览器只是发起 TCP 连接的应用，真正的通信由操作系统和 NAT 设备完成,NAT 持续存在，用于隐藏内网真实 IP，可以多台内网设备共享一个公网 IP 上网。)

3. 浏览器发出 http 请求:TCP 成功建立后
   浏览器开始发出请求报文:
   有三部分:请求行说明要干什么，请求头附带浏览器信息，cookie，认证等，请求体则是提交的数据
   请求经过 NAT 转换到达服务器，服务器解析报文准备生成响应

4. 服务器响应（服务器如何回复浏览器）
   服务器接先解析请求报文获得信息后
   根据信息找到静态文件或执行后端逻辑随服务器生成响应报文：
   状态行，告知浏览器结果（200 成功，404 找不到，500 服务器错误）响应头提供附加信息（类型，长度，cookie，缓存策略等）响应体真正的网页内容，数据（html，json，jpg 等）
   服务器将响应分成数据包，通过 TCP 四层传输发回客户端，浏览器接收后组装，渲染展示页面

   TCP 四层：由 http 应用层请求 tcp 协议传输层三次握手连接后通过网络层 IP 协议找到 IP 目标主机，最后通过网络接口层把数据以电信号发出

5. 浏览器渲染页面过程
   浏览器收到响应报文后解析响应体，检查响应头确定内容类型
   浏览器从上到下解析 HTML，生成 dom 树
   同步或异步加载外部 css 文件，解析生成 cssom
   有了 dom 与 cssom 浏览器合成渲染树
   layout 布局：浏览器根据渲染树计算每个元素位置与大小
   paint 绘制：将每个节点绘制在屏幕图层上
   composite 合成：GPU 将多个图层合成最终画面显示在屏幕

6. 浏览器后续加载与渲染优化
   浏览器异步加载如 img，video，script async 在不阻塞渲染情况下加载
   js 的加载可能触发 dom 改变，浏览器重排（reflow）或重绘（repaint）
   浏览器会根据响应头决定是否保存静态资源方便下次加载更快
   浏览器检查脚本，cookie，接口请求是否遵守同源或 cors 规则

# HTTP

http 是超文本传输协议，规定了浏览器和服务器之间如何请求传输数据
http1.1：基于 TCP 协议广泛使用，支持长连接，无需重复连接，但请求依次响应，外发同时发多个请求
http2：二进制传输，多路复用，一个连接可同时传递多条请求无需如 1.1 排队，有头部压缩，服务器主动推送
http3：基于 UDP+QUCI 协议解决了 TCP 堵塞，请求独立输送，丢包无影响，内置 tls1.3 加密更安全，支持连接迁移

## TCP协议 与 UDP
TCP面向连接，先连接后传输可靠但传输数据慢，UDP不用链接直接发送，不可靠但速度快QUIC在UDP上加入了连接管理，多路复用，内置加密，快速握手所以在http3适用

👨‍💻 应用层（你写的代码）
│
├── HTTP/1.1     ← 基于 TCP
├── HTTP/2       ← 基于 TCP + 多路复用
└── HTTP/3       ← 基于 QUIC (而 QUIC 又基于 UDP)
│
▼
📡 传输层（数据怎么传）
│
├── TCP  ← 有连接、可靠（握手、重传、排序）
├── UDP  ← 无连接、不可靠（快）
└── QUIC ← 基于 UDP 的“进化版 TCP”（HTTP/3 用它）
│
▼
🌍 网络层（找路）
│
└── IP（Internet Protocol）
      - 负责寻址、路由
      - 把包从一台电脑送到另一台
│
▼
🔌 数据链路层（真实信号）
│
└── 以太网 / Wi-Fi / 光纤 / 5G
      - 定义如何在物理网络上传输比特流
│
▼
⚡ 物理层（电信号、光信号、无线电波）

## 状态码

1xx：信息响应
2xx：成功连接
3xx：重定向，301 永久，302 临时
4xx：客户端错误，400bad request,401 未授权，404 未找到，403 禁止访问
5xx：服务器错误，500 服务器错误，501 网关错误，504 超时

## 报文结构

1. 请求报文 request
   请求行：get/index.html http/1.1
   请求头：Host，User-Agent，Cookie，Accept。。。
   请求体：POST 数据（JSON，Form，文件等）
2. 响应报文 response
   状态行：HTTP/1.1 200 OK
   响应头：Content-Type，Content-Length，Set-Cookie，Cache-Control..
   响应体：HTML，JSON，图片，视频等

## 缓存机制

浏览器缓存有强缓存与协商缓存
强缓存通过 Cache-Contorl 或 Expirse 控制，在有效期可直接使用
